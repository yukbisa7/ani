<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steamin Clone - Single File</title>
    <!-- CSS Tailwind (Online) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS Tambahan untuk animasi smooth */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .poster-card { transition: transform 0.3s; cursor: pointer; }
        .poster-card:hover { transform: translateY(-5px) scale(1.02); }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col">

    <!-- NAVBAR -->
    <header class="bg-gray-800 p-4 shadow-lg sticky top-0 z-50 border-b border-gray-700">
        <div class="container mx-auto flex justify-between items-center">
            <div onclick="app.showHome()" class="text-2xl font-bold text-red-500 cursor-pointer hover:text-red-400">
                Steamin Clone
            </div>
            <nav>
                <button onclick="app.showHome()" class="text-gray-300 hover:text-white font-medium">Home</button>
            </nav>
        </div>
    </header>

    <!-- MAIN CONTENT AREA -->
    <main class="container mx-auto p-4 flex-grow relative">
        
        <!-- 1. HALAMAN HOME -->
        <div id="view-home" class="fade-in">
            <h2 class="text-3xl font-bold mb-6 text-red-500 border-l-4 border-red-500 pl-3">Daftar Anime</h2>
            <div id="grid-anime" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                <!-- Data akan masuk di sini -->
                <p class="text-gray-500 col-span-full text-center py-10">Sedang memuat data dari server...</p>
            </div>
        </div>

        <!-- 2. HALAMAN DETAIL -->
        <div id="view-detail" class="hidden fade-in">
            <button onclick="app.showHome()" class="mb-4 text-gray-400 hover:text-white flex items-center gap-2">
                &larr; Kembali ke Home
            </button>
            <div id="detail-content" class="bg-gray-800 rounded-xl p-6 shadow-2xl">
                <!-- Detail akan masuk di sini -->
            </div>
        </div>

        <!-- 3. HALAMAN NONTON (WATCH) -->
        <div id="view-watch" class="hidden fade-in">
            <button onclick="app.backToDetail()" class="mb-4 text-gray-400 hover:text-white flex items-center gap-2">
                &larr; Kembali ke Detail
            </button>
            <div id="player-container" class="max-w-4xl mx-auto">
                <!-- Player akan masuk di sini -->
            </div>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-800 p-6 text-center text-gray-500 mt-8 border-t border-gray-700">
        <p>&copy; 2025 Steamin Clone. Single File Edition.</p>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        const API_URL = 'https://hosting.nakibo8225.workers.dev/json/b22b00540aee';

        // Aplikasi Utama
        const app = {
            data: [], // Menyimpan data dari API
            currentAnime: null, // Anime yang sedang dibuka

            // 1. Fungsi Inisialisasi (Dijalankan saat web dibuka)
            init: async function() {
                try {
                    const response = await fetch(API_URL);
                    if (!response.ok) throw new Error("Gagal ambil data");
                    const json = await response.json();
                    
                    // Cek struktur data
                    this.data = json.titles || []; 
                    
                    if (this.data.length === 0) {
                        document.getElementById('grid-anime').innerHTML = 
                            `<div class="col-span-full text-center text-red-400">
                                Data Kosong. <br> Silakan jalankan script POST suntik data di console lagi.
                            </div>`;
                        return;
                    }

                    this.renderHome();
                } catch (error) {
                    console.error(error);
                    document.getElementById('grid-anime').innerHTML = 
                        `<p class="col-span-full text-red-500">Gagal memuat data: ${error.message}</p>`;
                }
            },

            // 2. Render Halaman Home
            renderHome: function() {
                const grid = document.getElementById('grid-anime');
                grid.innerHTML = this.data.map(item => `
                    <div onclick="app.showDetail('${item.slug}')" class="poster-card bg-gray-700 rounded-lg overflow-hidden shadow-lg relative group">
                        <div class="relative pb-[150%]">
                            <img src="${item.poster}" class="absolute inset-0 w-full h-full object-cover" loading="lazy" alt="${item.title}">
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition flex items-center justify-center">
                                <span class="opacity-0 group-hover:opacity-100 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold shadow-lg">Nonton</span>
                            </div>
                        </div>
                        <div class="p-3">
                            <h3 class="font-bold text-white truncate">${item.title}</h3>
                            <p class="text-xs text-gray-400">${item.release_date} | ${item.status}</p>
                        </div>
                    </div>
                `).join('');
                
                // Tampilkan view home, sembunyikan yang lain
                this.switchView('view-home');
            },

            // 3. Render Halaman Detail
            showDetail: function(slug) {
                const anime = this.data.find(a => a.slug === slug);
                if (!anime) return alert("Anime tidak ditemukan!");
                
                this.currentAnime = anime; // Simpan state untuk tombol back

                const container = document.getElementById('detail-content');
                container.innerHTML = `
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="w-full md:w-1/3 lg:w-1/4 flex-shrink-0">
                            <img src="${anime.poster}" class="w-full rounded-lg shadow-lg border-2 border-gray-600">
                        </div>
                        <div class="flex-grow">
                            <h1 class="text-4xl font-bold text-red-500 mb-2">${anime.title}</h1>
                            <div class="flex gap-2 mb-4">
                                <span class="bg-gray-700 px-2 py-1 rounded text-xs">${anime.status}</span>
                                <span class="bg-gray-700 px-2 py-1 rounded text-xs">${anime.release_date}</span>
                            </div>
                            <p class="text-gray-300 mb-6 leading-relaxed">${anime.description}</p>
                            
                            <h3 class="text-xl font-bold border-b border-gray-600 pb-2 mb-4">Episode</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${anime.episodes.map(ep => `
                                    <button onclick="app.showWatch('${ep.slug}')" class="bg-gray-700 p-3 rounded hover:bg-red-600 hover:text-white transition text-left flex justify-between items-center group">
                                        <span class="font-semibold text-sm truncate pr-2">${ep.title}</span>
                                        <span class="text-xs bg-black bg-opacity-30 px-2 py-1 rounded group-hover:bg-opacity-50">Play</span>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                this.switchView('view-detail');
                window.scrollTo(0,0);
            },

            // 4. Render Halaman Nonton (Watch)
            showWatch: function(episodeSlug) {
                if(!this.currentAnime) return this.showHome();

                const episode = this.currentAnime.episodes.find(e => e.slug === episodeSlug);
                if(!episode) return alert("Episode Error");

                // Auto Play Rickroll Logic
                let videoUrl = episode.video_url;
                if(videoUrl.includes('youtube') && !videoUrl.includes('autoplay')) {
                    videoUrl += "&autoplay=1";
                }

                const container = document.getElementById('player-container');
                container.innerHTML = `
                    <div class="bg-black rounded-xl overflow-hidden shadow-2xl mb-4 border border-gray-700">
                        <div class="aspect-w-16 aspect-h-9 relative" style="padding-top: 56.25%">
                            <iframe src="${videoUrl}" class="absolute top-0 left-0 w-full h-full" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-yellow-400 mb-2">${this.currentAnime.title}</h2>
                    <h3 class="text-xl text-white mb-4">Episode: ${episode.title}</h3>
                    <div class="bg-gray-800 p-4 rounded text-sm text-gray-400">
                        ${episode.description || 'Tidak ada deskripsi.'}
                    </div>
                `;

                this.switchView('view-watch');
                window.scrollTo(0,0);
            },

            // Navigasi Balik
            backToDetail: function() {
                if(this.currentAnime) {
                    // Hentikan video (remove iframe) biar suara gak bocor
                    document.getElementById('player-container').innerHTML = ""; 
                    this.showDetail(this.currentAnime.slug);
                } else {
                    this.showHome();
                }
            },

            // Helper: Ganti Tampilan Div
            switchView: function(viewId) {
                ['view-home', 'view-detail', 'view-watch'].forEach(id => {
                    document.getElementById(id).classList.add('hidden');
                });
                document.getElementById(viewId).classList.remove('hidden');
            }
        };

        // Jalankan aplikasi
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>